+++
title = "Android Pentest"
date = "2021-04-02"
categories = [
    "security",
]
+++
### Bypass SSL pinning

##### Install Burpsuiteâ€™s certificate to system store

1. Export certificate with `Certificate in DER format` option and named `burp.der`
2. Convert certificate to crt/pem format: `openssl x509 -in burp.der -inform DER -out burp.crt`
3. Rename to `<hash>.0`, get hash: `openssl x509 -inform PEM -subject_hash_old -in burp.crt | head -n 1`
rename: `mv burp.crt 9a5ba575.0`
4. Backup existing certs: `adb shell "cp /system/etc/security/cacerts/* /tmp"`
5. Create an in-memory mount: `adb shell "mount -t tmpfs tmpfs /system/etc/security/cacerts"`
6. Copy the existing certs back into the tmpfs mount: `adb shell "mv /tmp/*.0 /system/etc/security/cacerts/"` 
7. Push `burp.crt` into cacerts folder: `adb push 9a5ba575.0 /system/etc/security/cacerts/`
8. Update the perms, so everything is as readable as before.
```bash
adb shell "chown root:root /system/etc/security/cacerts/*
chmod 644 /system/etc/security/cacerts/*
chcon u:object_r:system_file:s0 /system/etc/security/cacerts/*"
```

**Auto.sh**: export burp suite certificate and named `burp.der`

```bash
openssl x509 -in burp.der -inform DER -out burp.crt
hash=`openssl x509 -inform PEM -subject_hash_old -in burp.crt | head -n 1`.0
mv burp.crt $hash
adb shell "cp /system/etc/security/cacerts/* /tmp
mount -t tmpfs tmpfs /system/etc/security/cacerts
mv /tmp/*.0 /system/etc/security/cacerts/"
adb push $hash /system/etc/security/cacerts/
adb shell "chown root:root /system/etc/security/cacerts/*
chmod 644 /system/etc/security/cacerts/*
chcon u:object_r:system_file:s0 /system/etc/security/cacerts/*"
```

